# 未命名

# 计算机组成原理笔记：微程序控制器的组成架构

## 一、 整体架构概述

微程序控制器的核心逻辑是将**控制信号**存储在专门的存储器中，通过读取这些存储内容来控制计算机的运行。其硬件组成类似于一个小型的“CPU”，主要包含**存储部件**、**地址生成部件**和**寄存器**。

---

## 二、 核心组件详解

### 1. 控制存储器 (CS, Control Store)

这是微程序控制器的“大脑记忆区”。

- **功能：**  存放指令集中所有指令对应的**微程序**。
- **存储单元：**  每一个单元存放一条**微指令**。

  - **0号单元特殊性：**  通常存放**取指周期**微程序的第一条微指令。系统上电复位后，$\mu$AR 初始化为0，自动启动取指操作。
- **容量与字长：**

  - **存储容量**：取决于所有微程序包含的微指令总数。
  - **字长**：等于微指令的长度（比特位数）。
- **工作方式：**  每次读周期从 CS 中取出一条微指令。

### 2. 微地址寄存器 ($\mu$AR, Micro-Address Register)

类似于主CPU中的 **PC (程序计数器)** ，它是微程序的“指针”。

- **功能：**  为控制存储器（CS）提供**待读取微指令的地址**（即：微地址）。
- **工作流程：**

  1. **初始化：**  系统启动时 $\mu$AR = 0，指向取指微程序入口。
  2. **更新机制：**  按照时钟脉冲更新。每一个时钟脉冲到来，$\mu$AR 锁存新的微地址，从而从 CS 中读取下一条微指令。
  3. **输入来源：**  新的微地址来源于**地址转移逻辑**的输出。
- **时序细节（考研考点）：**  如果 CPU 内部控制信号要求在高电平（上升沿）有效，为了保证稳定，$\mu$AR 的更新通常在时钟周期的**下降沿**或周期结束时触发。

### 3. 地址转移逻辑 (Address Transfer Logic)

这是微程序的“导航员”，负责决定**下一条微指令在哪里**。

- **功能：**  产生下一条微指令的微地址。
- **决策依据（输入信号）：**

  1. **指令寄存器 (IR)：**  根据机器指令的操作码（Opcode），确定跳转到哪个具体指令的微程序入口（例如：是去执行 ADD 的微程序，还是 LDA 的微程序）。
  2. **外部状态条件 (**​**$FB_1 \sim FB_k$**​ **)：**  来自执行部件的标志位（如进位、零标志）。用于实现微程序的**分支跳转**。
  3. **当前微指令的信息：**  包含“判别测试字段”和“下址字段”。
- **生成方法：**

  - **下址字段法**（断定法）：直接在微指令中给出下一条地址。
  - **计数器法**：类似PC+1。
  -  *(注：图片提示这部分会有专门章节介绍，此处只需知道它是负责算地址的即可)*

### 4. 微指令寄存器 ($\mu$IR)

类似于主CPU中的 **IR (指令寄存器)** 。

- **功能：**  暂存从控制存储器 CS 中读出的当前微指令。
- **注意：**  图片中为了简化未画出 $\mu$IR 的框图，直接展示了微指令的格式，但在逻辑上它是存在的。
- **可见性：**  对**汇编程序员不可见**（属于计算机微体系结构设计）。

---

## 三、 微指令的格式与字段功能

一条从 CS 中读出的微指令，通常被划分为三个核心字段，各司其职：

|字段名称|功能描述|作用对象|
| :---------| :-------------------------------------------------------------------------------------------| :--------------|
|**操作控制字段**|**核心部分**。该字段的值通过控制总线传输到CPU所有执行部件的控制点（如ALU运算控制、寄存器三态门使能）。|**执行部件** (产生微操作)|
|**判别测试字段**|用于指明“何时跳转”。结合外部状态条件，决定是否改变原本的执行顺序。|**地址转移逻辑**|
|**下址字段**|指出“下一步去哪”。直接给出下一条微指令在 CS 中的地址（或基准地址）。|**地址转移逻辑** -> $\mu$AR|

---

## 四、 微程序控制器的工作流（通俗版）

可以将微程序控制器的工作想象成一个“查表执行”的循环过程：

1. **开机/复位**：

    - $\mu$AR 归零。
2. **取微指令**：

    - $\mu$AR 告诉 CS：“把 0 号房间的内容拿出来”。
    - CS 吐出一条微指令（通常是取指微指令）。
3. **执行与决策**：

    - **操作控制字段** 发号施令：“PC的值送MAR”、“读内存”。
    - 同时，**地址转移逻辑** 看着 **下址字段** 和 **IR中的指令** 以及 **状态标志**，计算出：“下一条微指令的地址是 X”。
4. **更新地址**：

    - 时钟一跳，X 进入 $\mu$AR。
5. **循环**：

    - 重复步骤 2，去 X 地址取下一条微指令。

---

## 五、 考研复习重点总结

1. **地址生成的来源**：微地址不是简单+1，它受**指令操作码**（决定微程序入口）、**状态标志**（决定分支）、**下址字段**共同控制。
2. **CS vs MM**：

    - **CS (控制存储器)**  存微指令，在 CPU 内部。
    - **MM (主存)**  存机器指令和数据，在 CPU 外部。
3. **$\mu$**​**AR vs PC**：

    - **$\mu$**​**AR** 记录微指令地址。
    - **PC** 记录机器指令地址。
4. **微程序入口**：系统上电后，$\mu$AR自动置0，CS的0号单元必须存放**取指微程序**的首条微指令（公共入口）。
